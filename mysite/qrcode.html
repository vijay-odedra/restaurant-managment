<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Table QR Code Generator for Restaurant Menu</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f8f9fa;
        color: #333;
        line-height: 1.6;
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
        padding-bottom: 100px; /* Add padding for footer */
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #4a6fa5, #2c3e50);
        color: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        margin-bottom: 10px;
        font-size: 2.5rem;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
      }

      .container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        margin-bottom: 30px;
      }

      .generator-section {
        flex: 1;
        min-width: 300px;
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .qr-display-section {
        flex: 1;
        min-width: 300px;
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #2c3e50;
      }

      input,
      select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        transition: border 0.3s;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #4a6fa5;
      }

      .table-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 10px;
        margin-top: 10px;
      }

      .table-option {
        padding: 12px;
        text-align: center;
        background-color: #f1f5f9;
        border: 2px solid #e2e8f0;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 600;
      }

      .table-option:hover {
        background-color: #e2e8f0;
      }

      .table-option.selected {
        background-color: #4a6fa5;
        color: white;
        border-color: #2c3e50;
      }

      .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 25px;
      }

      button {
        padding: 14px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: all 0.3s;
        flex: 1;
        min-width: 150px;
      }

      .btn-generate {
        background-color: #4a6fa5;
        color: white;
      }

      .btn-generate:hover {
        background-color: #3a5a85;
      }

      .btn-download {
        background-color: #2ecc71;
        color: white;
      }

      .btn-download:hover {
        background-color: #27ae60;
      }

      .btn-batch {
        background-color: #9b59b6;
        color: white;
      }

      .btn-batch:hover {
        background-color: #8e44ad;
      }

      .qr-container {
        margin: 20px 0;
        padding: 20px;
        background-color: white;
        border-radius: 5px;
        border: 1px solid #eee;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      #qrcode {
        margin-bottom: 15px;
      }

      #qrcode canvas,
      #qrcode img {
        max-width: 100% !important;
        height: auto !important;
      }

      .qr-info {
        text-align: center;
        margin-top: 15px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        width: 100%;
      }

      .table-number-display {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .qr-url {
        font-size: 14px;
        color: #666;
        word-break: break-all;
        margin-top: 10px;
      }

      .instructions {
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        margin-top: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .instructions h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .instructions ol {
        padding-left: 20px;
      }

      .instructions li {
        margin-bottom: 10px;
        padding-left: 10px;
      }

      .batch-section {
        background-color: white;
        padding: 25px;
        border-radius: 10px;
        margin-top: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .batch-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 15px;
      }

      .batch-input {
        flex: 1;
        min-width: 200px;
      }

      .qr-batch-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .batch-qr-item {
        padding: 15px;
        border: 1px solid #e2e8f0;
        border-radius: 5px;
        text-align: center;
        background-color: #f8f9fa;
      }

      /* Mobile Footer Styles */
      .mobile-footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(135deg, #2c3e50, #4a6fa5);
        color: white;
        padding: 15px 0;
        z-index: 1000;
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
        display: none; /* Hidden by default, shown on mobile */
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .footer-links {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        flex: 1;
      }

      .footer-link {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        color: white;
        font-size: 12px;
        transition: all 0.3s;
        padding: 5px 10px;
        border-radius: 5px;
        min-width: 60px;
      }

      .footer-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
      }

      .footer-link i {
        font-size: 20px;
        margin-bottom: 5px;
      }

      .footer-link span {
        font-size: 11px;
        text-align: center;
      }

      .footer-home {
        color: #4cd964;
      }

      .footer-dashboard {
        color: #ff9500;
      }

      .footer-menu {
        color: #ff3b30;
      }

      .footer-orders {
        color: #5856d6;
      }

      .footer-history {
        color: #5ac8fa;
      }

      .footer-help {
        color: #ffcc00;
      }

      @media (max-width: 768px) {
        body {
          padding-bottom: 80px; /* Adjust padding for mobile footer */
        }

        .container {
          flex-direction: column;
        }

        .button-group {
          flex-direction: column;
        }

        button {
          width: 100%;
        }

        .mobile-footer {
          display: block;
        }

        .table-grid {
          grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
        }

        .table-option {
          padding: 10px;
          font-size: 14px;
        }

        .header h1 {
          font-size: 1.8rem;
        }

        .header p {
          font-size: 1rem;
        }

        .footer-links {
          gap: 10px;
        }

        .footer-link {
          min-width: 50px;
          padding: 5px;
        }

        .footer-link i {
          font-size: 18px;
        }

        .footer-link span {
          font-size: 10px;
        }
      }

      @media (max-width: 480px) {
        .footer-links {
          gap: 5px;
        }

        .footer-link {
          min-width: 45px;
          padding: 4px;
        }

        .footer-link i {
          font-size: 16px;
        }

        .footer-link span {
          font-size: 9px;
        }

        .qr-batch-container {
          grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
      }

      /* Desktop Footer */
      .desktop-footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #eee;
        color: #7f8c8d;
        font-size: 0.9rem;
      }

      .desktop-footer-links {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .desktop-footer-link {
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
        color: #4a6fa5;
        font-weight: 500;
        padding: 8px 15px;
        border-radius: 5px;
        transition: all 0.3s;
      }

      .desktop-footer-link:hover {
        background-color: #f0f7ff;
        color: #2c3e50;
      }

      .desktop-footer-link i {
        font-size: 18px;
      }

      @media (max-width: 768px) {
        .desktop-footer {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <!-- Header with Navigation -->
    <div class="header">
      <div class="container">
        <div class="logo">
          <i class="fas fa-utensils"></i>
          <h1>Gourmet Restaurant</h1>
        </div>
        <div class="session-info">
          <div class="table-info">
            <i class="fas fa-table"></i>
            <span>Table: <strong id="table-number">Loading...</strong></span>
          </div>
          <div class="token-display" id="token-display" style="display: none">
            <i class="fas fa-hashtag"></i>
            <span>Token: <strong id="current-token">---</strong></span>
          </div>
        </div>
        <div class="nav-buttons">
          <button class="nav-btn active" data-section="menu">
            <i class="fas fa-th-large"></i> Menu Categories
          </button>
          <button class="nav-btn" data-section="cart">
            <i class="fas fa-shopping-cart"></i> Current Order
            <span class="cart-count-badge">0</span>
          </button>
          <button class="nav-btn" data-section="history">
            <i class="fas fa-history"></i> Order History
          </button>
          <!-- ADDED: Back to Dashboard Button -->
          <button class="nav-btn" id="back-to-dashboard">
            <i class="fas fa-tachometer-alt"></i> Dashboard
          </button>
        </div>
      </div>
    </div>

    <!-- Main Content Container -->
    <div class="container">
      <!-- Menu Categories Section -->
      <div id="menu-section" class="content-section active">
        <div class="menu-header">
          <h2 class="menu-title">
            <i class="fas fa-th-large"></i> Food Categories
          </h2>
        </div>
        <div class="main-menu" id="category-cards">
          <!-- Category cards will be dynamically loaded here -->
        </div>
      </div>

      <!-- Cart/Order Section -->
      <div id="cart-section" class="content-section">
        <div class="menu-header">
          <h2 class="menu-title">
            <i class="fas fa-shopping-cart"></i> Current Order
          </h2>
          <div class="category-filter">
            <button class="category-btn active" data-category="all">
              <i class="fas fa-th-large"></i> All Items
            </button>
            <button class="category-btn" data-category="starters">
              <i class="fas fa-utensil-spoon"></i> Starters
            </button>
            <button class="category-btn" data-category="mains">
              <i class="fas fa-drumstick-bite"></i> Main Course
            </button>
            <button class="category-btn" data-category="desserts">
              <i class="fas fa-ice-cream"></i> Desserts
            </button>
            <button class="category-btn" data-category="drinks">
              <i class="fas fa-glass-whiskey"></i> Drinks
            </button>
          </div>
        </div>
        <div class="menu-content">
          <!-- Menu Items Section -->
          <div class="menu-items" id="menu-items-container">
            <!-- Menu items will be dynamically loaded here -->
          </div>
          <!-- Order Summary Section -->
          <div class="order-summary-container">
            <div class="order-summary">
              <div class="summary-header">
                <i class="fas fa-shopping-cart"></i>
                <h3>Order Summary</h3>
              </div>
              <div class="cart-items" id="cart-items">
                <div class="empty-cart">
                  <i class="fas fa-shopping-cart"></i>
                  <h4>Your cart is empty</h4>
                  <p>Add items from the menu to get started</p>
                </div>
              </div>
              <div class="cart-total">
                <span class="total-label">Total Amount:</span>
                <span class="total-amount" id="total-amount">$0.00</span>
              </div>
              <div class="special-instructions">
                <label class="instructions-label">
                  <i class="fas fa-edit"></i> Special Instructions
                </label>
                <textarea
                  class="instructions-textarea"
                  id="special-instructions"
                  placeholder="Add any special instructions for your order (allergies, preferences, etc.)..."
                ></textarea>
              </div>
              <div class="order-buttons">
                <button
                  class="order-btn btn-primary"
                  id="place-order-btn"
                  disabled
                >
                  <i class="fas fa-paper-plane"></i> Place Order Now
                </button>
                <button class="order-btn btn-danger" id="cancel-order-btn">
                  <i class="fas fa-times"></i> Cancel Order
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Order History Section -->
      <div id="history-section" class="content-section">
        <div class="history-header">
          <h2 class="history-title">
            <i class="fas fa-history"></i> Order History - Table
            <span id="history-table-number"></span>
          </h2>
          <div class="history-controls">
            <button class="history-btn" id="refresh-history-btn">
              <i class="fas fa-sync-alt"></i> Refresh
            </button>
            <button class="history-btn" id="clear-history-btn">
              <i class="fas fa-trash-alt"></i> Clear History
            </button>
          </div>
        </div>
        <div class="order-history" id="order-history-container">
          <div class="history-empty">
            <i class="fas fa-history"></i>
            <h4>No Order History</h4>
            <p>Your order history for this table will appear here</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div id="order-modal" class="modal-overlay" style="display: none">
      <div class="modal">
        <div class="modal-header">
          <i class="fas fa-check-circle"></i>
          <h3>Order Placed Successfully!</h3>
          <p style="opacity: 0.9; margin-top: 5px">
            Your order is now being prepared
          </p>
        </div>
        <div class="modal-content">
          <p class="modal-message">
            Thank you for your order! Please show this token number to the staff
            when collecting your food.
          </p>
          <div class="modal-token" id="modal-token">TK-00123</div>
          <div class="modal-details" id="order-details">
            <!-- Order details will be dynamically loaded here -->
          </div>
          <div class="modal-actions">
            <button
              class="modal-btn modal-btn-secondary"
              id="print-summary-btn"
            >
              <i class="fas fa-print"></i> Print Bill
            </button>
            <button
              class="modal-btn modal-btn-primary"
              id="continue-ordering-btn"
            >
              <i class="fas fa-plus-circle"></i> Continue Ordering
            </button>
            <!-- ADDED: Dashboard Button -->
            <button
              class="modal-btn modal-btn-secondary"
              id="go-to-dashboard-btn"
            >
              <i class="fas fa-tachometer-alt"></i> Go to Dashboard
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- History Detail Modal -->
    <div id="history-detail-modal" class="modal-overlay" style="display: none">
      <div class="modal history-detail-modal">
        <div class="modal-header">
          <i class="fas fa-receipt"></i>
          <h3 id="history-detail-title">Order Details</h3>
        </div>
        <div class="modal-content">
          <div class="modal-details" id="history-detail-content">
            <!-- History order details will be loaded here -->
          </div>
          <div class="modal-actions">
            <button
              class="modal-btn modal-btn-secondary"
              id="print-history-btn"
            >
              <i class="fas fa-print"></i> Print Receipt
            </button>
            <button
              class="modal-btn modal-btn-primary"
              id="close-history-detail-btn"
            >
              <i class="fas fa-times"></i> Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Enhanced Restaurant Menu System with Dashboard Integration
      const MenuSystem = {
        currentTable: null,
        currentToken: null,
        cart: [],
        isOrderPlaced: false,
        currentCategory: null,
        currentSection: "menu",
        dashboardPath: "dashboard.html", // Path to dashboard

        // Your existing menu items and categories remain exactly the same
        // ... (all your menu items data) ...

        init: function () {
          this.extractQRCodeData();
          this.setupEventListeners();
          this.loadMainMenu();
          this.updateOrderSummary();
          this.loadFromStorage();
          this.updateCartCount();
        },

        extractQRCodeData: function () {
          const urlParams = new URLSearchParams(window.location.search);
          const tableFromQR = urlParams.get("table");

          if (tableFromQR) {
            this.currentTable = tableFromQR;
          } else {
            // Try to get from localStorage first
            const savedTable = localStorage.getItem("currentTable");
            if (savedTable) {
              this.currentTable = savedTable;
            } else {
              const tables = [
                "01",
                "02",
                "03",
                "04",
                "05",
                "06",
                "07",
                "08",
                "09",
                "10",
              ];
              this.currentTable =
                tables[Math.floor(Math.random() * tables.length)];
            }
          }

          // Save table to localStorage for dashboard
          localStorage.setItem("currentTable", this.currentTable);

          this.generateNewToken();

          document.getElementById("table-number").textContent =
            this.currentTable;
          document.getElementById("current-token").textContent =
            this.currentToken;
          document.getElementById("token-display").style.display = "flex";
          document.getElementById("history-table-number").textContent =
            this.currentTable;
        },

        // UPDATED: Generate token compatible with dashboard system
        generateNewToken: function () {
          // Load the shared database
          let restaurantData = JSON.parse(
            localStorage.getItem("restaurantDatabase") ||
              '{"orders": [], "history": [], "settings": {}, "tokenCounter": 1001}'
          );

          const tokenCounter = restaurantData.tokenCounter || 1001;
          this.currentToken = `TK-${tokenCounter.toString().padStart(5, "0")}`;

          // Save updated token counter back to database
          restaurantData.tokenCounter = tokenCounter + 1;
          localStorage.setItem(
            "restaurantDatabase",
            JSON.stringify(restaurantData)
          );
        },

        // NEW: Save order to shared database (compatible with dashboard)
        saveOrderToDatabase: function (order) {
          // Load existing database
          let restaurantData = JSON.parse(
            localStorage.getItem("restaurantDatabase") ||
              '{"orders": [], "history": [], "settings": {}, "tokenCounter": 1001}'
          );

          // Initialize arrays if they don't exist
          if (!restaurantData.orders) restaurantData.orders = [];
          if (!restaurantData.history) restaurantData.history = [];

          // Add to active orders
          restaurantData.orders.push(order);

          // Also add to history for permanent record
          restaurantData.history.push(order);

          // Update token counter
          restaurantData.tokenCounter =
            (restaurantData.tokenCounter || 1001) + 1;

          // Save back to localStorage
          localStorage.setItem(
            "restaurantDatabase",
            JSON.stringify(restaurantData)
          );

          console.log("Order saved to shared database:", order);

          // Also save to old format for backward compatibility
          this.saveOrderToHistory(order);
        },

        // MODIFIED: Load order history from shared database
        loadOrderHistory: function () {
          const container = document.getElementById("order-history-container");
          const tableNumberSpan = document.getElementById(
            "history-table-number"
          );

          if (tableNumberSpan) {
            tableNumberSpan.textContent = this.currentTable;
          }

          if (!container) return;

          container.innerHTML = "";

          // Get orders from shared database
          let restaurantData = JSON.parse(
            localStorage.getItem("restaurantDatabase") ||
              '{"orders": [], "history": [], "settings": {}}'
          );

          // Try history first, then fallback to orders
          const allOrders =
            restaurantData.history || restaurantData.orders || [];

          // Filter orders for current table
          const tableOrders = allOrders.filter(
            (order) => order.table === this.currentTable
          );

          if (tableOrders.length === 0) {
            container.innerHTML = `
              <div class="history-empty">
                <i class="fas fa-history"></i>
                <h4>No Order History</h4>
                <p>Your order history for this table will appear here</p>
              </div>
            `;
            return;
          }

          // Sort orders by timestamp (newest first)
          tableOrders.sort(
            (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
          );

          // Create history cards
          tableOrders.forEach((order, index) => {
            const historyCard = document.createElement("div");
            historyCard.className = "history-order-card";
            historyCard.dataset.orderIndex = index;

            let itemsHTML = "";
            let orderTotal = 0;

            order.items.forEach((item) => {
              const itemTotal = item.price * item.quantity;
              orderTotal += itemTotal;

              itemsHTML += `
                <div class="history-item">
                  <div class="history-item-name">${item.name}</div>
                  <div class="history-item-quantity">x${item.quantity}</div>
                  <div class="history-item-price">$${itemTotal.toFixed(2)}</div>
                </div>
              `;
            });

            const orderDate = new Date(order.timestamp);
            const formattedDate = orderDate.toLocaleDateString();
            const formattedTime = orderDate.toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
            });

            historyCard.innerHTML = `
              <div class="history-order-header">
                <div class="history-token">${order.token}</div>
                <div class="history-time">
                  <i class="far fa-calendar"></i> ${formattedDate} at ${formattedTime}
                </div>
              </div>
              <div class="history-order-details">
                ${itemsHTML}
              </div>
              <div class="history-order-total">
                <span class="history-total-label">Total:</span>
                <span class="history-total-amount">$${orderTotal.toFixed(
                  2
                )}</span>
              </div>
              <div class="history-order-status">
                <i class="fas fa-check-circle"></i> ${
                  order.status || "Order Placed"
                }
              </div>
            `;

            // Add click event to view order details
            historyCard.addEventListener("click", () => {
              this.showOrderDetails(order);
            });

            container.appendChild(historyCard);
          });
        },

        // MODIFIED: Place order saves to both systems
        placeOrder: function () {
          if (this.cart.length === 0) return;

          const instructions = document.getElementById(
            "special-instructions"
          ).value;
          let total = 0;
          this.cart.forEach((item) => {
            total += item.price * item.quantity;
          });

          const order = {
            token: this.currentToken,
            table: this.currentTable,
            items: [...this.cart],
            total: total,
            instructions: instructions,
            time: new Date().toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
            }),
            date: new Date().toISOString().split("T")[0],
            timestamp: new Date().toISOString(),
            status: "Order Placed",
          };

          // Save to shared database (dashboard compatible)
          this.saveOrderToDatabase(order);

          this.generateNewToken();
          document.getElementById("current-token").textContent =
            this.currentToken;
          this.isOrderPlaced = true;
          this.showOrderConfirmation(order);

          this.cart = [];
          document.querySelectorAll(".quantity").forEach((qty) => {
            qty.textContent = "0";
          });
          document.getElementById("special-instructions").value = "";
          this.updateOrderSummary();
          this.updateCartCount();
          this.saveToStorage();
        },

        // NEW: Setup dashboard navigation
        setupEventListeners: function () {
          // Navigation buttons
          document.querySelectorAll(".nav-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const button = e.target.closest(".nav-btn");

              // Check if it's the dashboard button
              if (button.id === "back-to-dashboard") {
                this.goToDashboard();
                return;
              }

              const section = button.dataset.section;
              this.showSection(section);
            });
          });

          // Add dashboard button in modal
          document
            .getElementById("go-to-dashboard-btn")
            ?.addEventListener("click", () => {
              this.goToDashboard();
            });

          // Your existing event listeners...
          document.querySelectorAll(".category-btn").forEach((btn) => {
            btn.addEventListener("click", (e) => {
              const category =
                e.target.closest(".category-btn").dataset.category;
              this.filterMenuByCategory(category);
            });
          });

          document
            .getElementById("place-order-btn")
            .addEventListener("click", () => this.placeOrder());
          document
            .getElementById("cancel-order-btn")
            .addEventListener("click", () => this.cancelOrder());
          document
            .getElementById("refresh-history-btn")
            .addEventListener("click", () => this.loadOrderHistory());
          document
            .getElementById("clear-history-btn")
            .addEventListener("click", () => this.clearHistory());
          document
            .getElementById("continue-ordering-btn")
            .addEventListener("click", () => this.continueOrdering());
          document
            .getElementById("print-summary-btn")
            .addEventListener("click", () => this.printBill());
          document
            .getElementById("print-history-btn")
            .addEventListener("click", () => this.printHistoryBill());
          document
            .getElementById("close-history-detail-btn")
            .addEventListener("click", () => {
              document.getElementById("history-detail-modal").style.display =
                "none";
            });

          // Close modals when clicking outside
          document.querySelectorAll(".modal-overlay").forEach((modal) => {
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                modal.style.display = "none";
              }
            });
          });
        },

        // NEW: Navigate to dashboard
        goToDashboard: function () {
          // Save current session
          this.saveToStorage();

          // Redirect to dashboard with table parameter
          window.location.href = `${this.dashboardPath}?table=${this.currentTable}`;
        },

        // Your existing functions remain mostly the same...
        loadMainMenu: function () {
          // ... (your existing code)
        },

        showSection: function (section) {
          // ... (your existing code)
        },

        setActiveCategoryButton: function (categoryId) {
          // ... (your existing code)
        },

        loadMenuItems: function () {
          // ... (your existing code)
        },

        filterMenuByCategory: function (category) {
          // ... (your existing code)
        },

        adjustQuantity: function (itemId, change) {
          // ... (your existing code)
        },

        addItemToCart: function (itemId) {
          // ... (your existing code)
        },

        updateOrderSummary: function () {
          // ... (your existing code)
        },

        updateCartCount: function () {
          // ... (your existing code)
        },

        showOrderDetails: function (order) {
          // ... (your existing code)
        },

        showOrderConfirmation: function (order) {
          // ... (your existing code)
        },

        continueOrdering: function () {
          // ... (your existing code)
        },

        cancelOrder: function () {
          // ... (your existing code)
        },

        clearHistory: function () {
          // ... (your existing code updated for shared database)
        },

        printBill: function () {
          // ... (your existing code)
        },

        printHistoryBill: function () {
          // ... (your existing code)
        },

        printReceipt: function (token, details) {
          // ... (your existing code)
        },

        saveToStorage: function () {
          // ... (your existing code)
        },

        loadFromStorage: function () {
          // ... (your existing code)
        },

        // Keep for backward compatibility
        saveOrderToHistory: function (order) {
          let restaurantData = JSON.parse(
            localStorage.getItem("restaurantData") ||
              '{"allOrders": [], "tokenCounter": 1001}'
          );
          if (!restaurantData.allOrders) restaurantData.allOrders = [];
          restaurantData.allOrders.push(order);
          restaurantData.tokenCounter =
            (restaurantData.tokenCounter || 1001) + 1;
          localStorage.setItem(
            "restaurantData",
            JSON.stringify(restaurantData)
          );
        },
      };

      document.addEventListener("DOMContentLoaded", function () {
        MenuSystem.init();
      });
    </script>
  </body>
</html>
